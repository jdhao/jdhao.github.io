<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Dependency Hell When Building A PyTorch GPU Docker Image - jdhao's blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="jdhao"><meta name=description content="In order to for PyTorch to use host GPU inside a Docker container, their versions must match.
"><meta name=keywords content="Hugo,theme,even">
<meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw">
<meta name=generator content="Hugo 0.92.1 with theme even">
<link rel=canonical href=https://jdhao.github.io/2022/02/09/dependency-hell-build-torch-GPU-docker-container/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="Dependency Hell When Building A PyTorch GPU Docker Image">
<meta property="og:description" content="In order to for PyTorch to use host GPU inside a Docker container, their versions must match.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jdhao.github.io/2022/02/09/dependency-hell-build-torch-GPU-docker-container/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2022-02-09T21:30:00+08:00">
<meta property="article:modified_time" content="2022-02-09T21:40:23+08:00">
<meta itemprop=name content="Dependency Hell When Building A PyTorch GPU Docker Image">
<meta itemprop=description content="In order to for PyTorch to use host GPU inside a Docker container, their versions must match."><meta itemprop=datePublished content="2022-02-09T21:30:00+08:00">
<meta itemprop=dateModified content="2022-02-09T21:40:23+08:00">
<meta itemprop=wordCount content="281">
<meta itemprop=keywords content="PyTorch,Docker,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Dependency Hell When Building A PyTorch GPU Docker Image">
<meta name=twitter:description content="In order to for PyTorch to use host GPU inside a Docker container, their versions must match."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>jdhao's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/about/>
<li class=mobile-menu-item>About</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>jdhao's blog</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>About</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Dependency Hell When Building A PyTorch GPU Docker Image</h1>
<div class=post-meta>
<span class=post-time> 2022-02-09 </span>
<div class=post-category>
<a href=/categories/machine-learning/> machine-learning </a>
</div>
<span class=more-meta> 281 words </span>
<span class=more-meta> 2 mins read </span>
<span id=busuanzi_container_page_pv class=more-meta> <span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Contents</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ol>
<li><a href=#use-correct-nvidia-cuda-docker-as-base-image>Use correct nvidia-cuda docker as base image</a></li>
<li><a href=#pytorch-and-torchvision-versions>PyTorch and torchvision versions</a>
<ol>
<li><a href=#find-suitable-pytorch-version>Find suitable PyTorch version</a></li>
<li><a href=#match-torchvision-with-torch-version>Match torchvision with torch version</a></li>
</ol>
</li>
<li><a href=#ref>Ref</a></li>
</ol>
</nav>
</div>
</div>
<div class=post-content>
<p>In order to for PyTorch to use host GPU inside a Docker container, their versions must match.</p>
<h1 id=use-correct-nvidia-cuda-docker-as-base-image>Use correct nvidia-cuda docker as base image</h1>
<p>First, in order to use GPU, we can not just use a regular docker image as the base image,
we need to use images provided by <a href=https://hub.docker.com/r/nvidia/cuda><code>nvidia/cuda</code></a>. For example, to use CUDA 10.1 as the base image:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=k>FROM</span><span class=s> nvidia/cuda:10.1-cudnn7-devel-ubuntu18.04</span><span class=err>
</span><span class=err></span><span class=c>#... other build steps follows</span><span class=err>
</span></code></pre></div><p>Otherwise, even if you have installed PyTorch inside the container, <code>torch.cuda.is_available()</code> is still <code>False</code>.</p>
<h1 id=pytorch-and-torchvision-versions>PyTorch and torchvision versions</h1>
<p>Another point to remember is to install the right version of PyTorch that supports your CUDA versions.
If you install PyTorch without specifying the version, the latest one is installed.
It will have higher requirement for CUDA version. If you try to use CUDA, then you see error like this:</p>
<style type=text/css>@import '//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css';.error-msg{color:#d8000c;background-color:#ffbaba;margin:5px 0;margin-bottom:20px;padding:10px;border-radius:5px 5px 5px 5px;border:2px solid transparent;border-color:transparent}</style>
<div class=error-msg>
<i class="fa fa-times-circle"></i>
pytorch the nvidia driver on your system is too old (found version 10010)
</div>
<p>To check which version of CUDA torch is built with, use <code>torch.version.cuda</code> (source <a href=https://stackoverflow.com/a/64145989/6064933>here</a>).</p>
<h2 id=find-suitable-pytorch-version>Find suitable PyTorch version</h2>
<p>To find the PyTorch version built with CUDA 10.1, in the <a href=https://download.pytorch.org/whl/torch_stable.html>PyTorch stable release page</a>, search <code>cu101</code>.
We know that there is v1.6.0 built with CUDA 10.1, then we can run the following command to install v1.6.0:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>pip install torch==1.6.0+cu101 -f https://download.pytorch.org/whl/torch_stable.html
</code></pre></div><h2 id=match-torchvision-with-torch-version>Match torchvision with torch version</h2>
<p>The torchvision package version should also match version of torch.
In <a href=https://github.com/pytorch/vision#installation>this page</a>, we can see a table of version correspondence.
For example, for torch 1.6.0, torchvision 0.7.0 is fine. So our final install command:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>pip install torch==1.6.0+cu101 torchvision==0.7.0 -f https://download.pytorch.org/whl/torch_stable.html
</code></pre></div><h1 id=ref>Ref</h1>
<p><a href=https://pytorch.org/get-started/previous-versions/>https://pytorch.org/get-started/previous-versions/</a></p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>Author</span>
<span class=item-content>jdhao</span>
</p>
<p class=copyright-item>
<span class=item-title>LastMod</span>
<span class=item-content>
2022-02-09
</span>
</p>
<p class=copyright-item>
<span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<div class=post-reward>
<input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>Reward</label>
<div class=qr-code>
<label class=qr-code-image for=reward>
<img class=image src=https://blog-resource-1257868508.file.myqcloud.com/wechat.png>
<span>wechat</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=https://blog-resource-1257868508.file.myqcloud.com/zhifubao.jpg>
<span>alipay</span>
</label>
</div>
</div><footer class=post-footer>
<div class=post-tags>
<a href=/tags/PyTorch/>PyTorch</a>
<a href=/tags/Docker/>Docker</a>
</div>
<nav class=post-nav>
<a class=next href=/2022/02/02/executable_not_allowed_to_run_in_hugo/>
<span class="next-text nav-default">External Executable Not Allowed to Run after Hugo v0.91?</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a>
<a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://www.linkedin.com/in/jiedong-hao-740163227/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/jdhao class="iconfont icon-github" title=github></a>
<a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<div class=busuanzi-footer>
<span id=busuanzi_container_site_pv> site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> </span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv> site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> </span>
</div>
<span class=copyright-year>
&copy;
2017 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],tags:'ams'}}</script>
<script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-113395108-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_push>(function(){var a,c,b;if(window.location.hostname==='localhost')return;a=document.createElement('script'),a.async=!0,c=window.location.protocol.split(':')[0],c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>