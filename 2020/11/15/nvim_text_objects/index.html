<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>A Beginner's Guide on Creating Your Own Text Objects from Scratch in Neovim/Vim - jdhao's blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="jdhao"><meta name=description content="Shortly after I started using Neovim, I learned about the concept of text objects. For example, when the cursor is inside a pair of [], we can use ci] to change text inside them. This is definitely one of the greatest moments on my road of learning Vim. However, I haven&amp;rsquo;t really thought about how does text object really work.
"><meta name=keywords content="Hugo,theme,even">
<meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw">
<meta name=generator content="Hugo 0.92.1 with theme even">
<link rel=canonical href=https://jdhao.github.io/2020/11/15/nvim_text_objects/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="A Beginner's Guide on Creating Your Own Text Objects from Scratch in Neovim/Vim">
<meta property="og:description" content="Shortly after I started using Neovim, I learned about the concept of text objects.
For example, when the cursor is inside a pair of [], we can use ci] to
change text inside them. This is definitely one of the greatest moments on my
road of learning Vim. However, I haven&rsquo;t really thought about how does text
object really work.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jdhao.github.io/2020/11/15/nvim_text_objects/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-11-15T15:00:06+08:00">
<meta property="article:modified_time" content="2022-02-02T00:57:54+08:00">
<meta itemprop=name content="A Beginner's Guide on Creating Your Own Text Objects from Scratch in Neovim/Vim">
<meta itemprop=description content="Shortly after I started using Neovim, I learned about the concept of text objects.
For example, when the cursor is inside a pair of [], we can use ci] to
change text inside them. This is definitely one of the greatest moments on my
road of learning Vim. However, I haven&rsquo;t really thought about how does text
object really work."><meta itemprop=datePublished content="2020-11-15T15:00:06+08:00">
<meta itemprop=dateModified content="2022-02-02T00:57:54+08:00">
<meta itemprop=wordCount content="1187">
<meta itemprop=keywords content="text-object,Vim,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="A Beginner's Guide on Creating Your Own Text Objects from Scratch in Neovim/Vim">
<meta name=twitter:description content="Shortly after I started using Neovim, I learned about the concept of text objects.
For example, when the cursor is inside a pair of [], we can use ci] to
change text inside them. This is definitely one of the greatest moments on my
road of learning Vim. However, I haven&rsquo;t really thought about how does text
object really work."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>jdhao's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/about/>
<li class=mobile-menu-item>About</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>jdhao's blog</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>About</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>A Beginner's Guide on Creating Your Own Text Objects from Scratch in Neovim/Vim</h1>
<div class=post-meta>
<span class=post-time> 2020-11-15 </span>
<div class=post-category>
<a href=/categories/Nvim/> Nvim </a>
</div>
<span class=more-meta> 1187 words </span>
<span class=more-meta> 6 mins read </span>
<span id=busuanzi_container_page_pv class=more-meta> <span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Contents</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ol>
<li><a href=#how-to-define-new-text-objects>How to define new text objects</a></li>
<li><a href=#text-object-for-url>Text object for URL</a></li>
<li><a href=#a-text-object-for-markdown-code-blocks>A text object for Markdown code blocks</a></li>
<li><a href=#conclusion>Conclusion</a></li>
<li><a href=#references>References</a></li>
</ol>
</nav>
</div>
</div>
<div class=post-content>
<p>Shortly after I started using <a href=https://github.com/neovim/neovim>Neovim</a>, I learned about the concept of <a href=https://neovim.io/doc/user/motion.html#text-objects>text objects</a>.
For example, when the cursor is inside a pair of <code>[]</code>, we can use <code>ci]</code> to
change text inside them. This is definitely one of the greatest moments on my
road of learning Vim. However, I haven&rsquo;t really thought about how does text
object really work.</p>
<p>Since I use Markdown frequently, I often need to change URLs quickly. I thought
it might be a good idea to define a text object for URL. Actually, there are already
<a href=https://github.com/mattn/vim-textobj-url>some</a> <a href=https://github.com/LeonB/vim-textobj-url>plugins</a> for it. However, they all rely on another
plugin. Besides, I also want to learn how to write my own text objects from
scratch. So I read some documentation and online posts. Now, I am able to
create my own text objects with ease.</p>
<h1 id=how-to-define-new-text-objects>How to define new text objects</h1>
<p>We can think of a text object as a piece of text. <strong>It is visually selected
when we press the shortcut that defines it</strong>. When we want to define a new text
objects, all we need to figure out is: how do we select it when we press the
shortcut?</p>
<p>To select the desired text, it boils down to understanding two things:</p>
<ul>
<li>The start and end position of this text object</li>
<li>Is it character-wise or line-wise or even block-wise (I haven&rsquo;t found block-wise useful, though)?</li>
</ul>
<p>Now, it is easy to define new text objects. All we do is to make sure that the
desired text is selected when we press the shortcut. It does not really matter
how do you achieve that with Vim script.</p>
<p>For example, if we want to define a text object for <strong>inner</strong> line (excluding
blank space at head and tail of current line). Here is one such implementation:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>xnoremap</span> <span class=nx>il</span> ^<span class=nx>og_</span><span class=err>
</span><span class=err></span><span class=nx>onoremap</span> <span class=nx>il</span> :<span class=nx>normal</span> <span class=nx>vil</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></code></pre></div><p>In the above xnoremap, <code>o</code> is used to move cursor from on end of visual
selection to another end, see <a href=https://neovim.io/doc/user/visual.html#v_o><code>:h v_o</code></a>.</p>
<h1 id=text-object-for-url>Text object for URL</h1>
<p>To define a text object for URL, we need to first decide the complete URL text
under cursor, find its start and end position in current line, then select the
entire URL text in visual mode (char-wise not line-wise).</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>vnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>iu</span> :<span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>U</span><span class=p>&gt;</span><span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>URLTextObj</span><span class=p>()&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err></span><span class=nx>onoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>iu</span> :<span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>U</span><span class=p>&gt;</span><span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>URLTextObj</span><span class=p>()&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>URLTextObj</span><span class=p>()</span> <span class=nx>abort</span><span class=err>
</span><span class=err></span>  <span class=k>if</span> <span class=nx>match</span><span class=p>(</span>&amp;<span class=nx>runtimepath</span><span class=p>,</span> <span class=s1>&#39;vim-highlighturl&#39;</span><span class=p>)</span> <span class=p>!=</span> <span class=m>-1</span><span class=err>
</span><span class=err></span><span class=c>    &#34; Note that we use https://github.com/itchyny/vim-highlighturl to get the URL pattern.</span><span class=err>
</span><span class=err></span>    <span class=k>let</span> <span class=nx>url_pattern</span> <span class=p>=</span> <span class=nx>highlighturl</span>#<span class=nx>default_pattern</span><span class=p>()</span><span class=err>
</span><span class=err></span>  <span class=k>else</span><span class=err>
</span><span class=err></span>    <span class=k>let</span> <span class=nx>url_pattern</span> <span class=p>=</span> <span class=nx>expand</span><span class=p>(</span><span class=s1>&#39;&lt;cfile&gt;&#39;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=c>    &#34; Since expand(&#39;&lt;cfile&gt;&#39;) also works for normal words, we need to check if</span><span class=err>
</span><span class=err></span><span class=c>    &#34; this is really URL using heuristics, e.g., URL length.</span><span class=err>
</span><span class=err></span>    <span class=k>if</span> <span class=nx>len</span><span class=p>(</span><span class=nx>url_pattern</span><span class=p>)</span> <span class=p>&lt;=</span> <span class=m>10</span><span class=err>
</span><span class=err></span>      <span class=nx>return</span><span class=err>
</span><span class=err></span>    <span class=k>endif</span><span class=err>
</span><span class=err></span>  <span class=k>endif</span><span class=err>
</span><span class=err></span><span class=c>
</span><span class=c>  &#34; We need to find all possible URL on this line and their start, end idx.</span><span class=err>
</span><span class=err></span><span class=c>  &#34; Then find where current cursor is, and decide if cursor is on one of the</span><span class=err>
</span><span class=err></span><span class=c>  &#34; URLs.</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>line_text</span> <span class=p>=</span> <span class=nx>getline</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>url_infos</span> <span class=p>=</span> []<span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> [<span class=nx>_url</span><span class=p>,</span> <span class=nx>_idx_start</span><span class=p>,</span> <span class=nx>_idx_end</span>] <span class=p>=</span> <span class=nx>matchstrpos</span><span class=p>(</span><span class=nx>line_text</span><span class=p>,</span> <span class=nx>url_pattern</span><span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=nx>while</span> <span class=nx>_url</span> <span class=p>!=</span># <span class=s1>&#39;&#39;</span><span class=err>
</span><span class=err></span>    <span class=k>let</span> <span class=nx>url_infos</span> <span class=p>+=</span> [[<span class=nx>_url</span><span class=p>,</span> <span class=nx>_idx_start</span><span class=p>+</span><span class=m>1</span><span class=p>,</span> <span class=nx>_idx_end</span>]]<span class=err>
</span><span class=err></span>    <span class=k>let</span> [<span class=nx>_url</span><span class=p>,</span> <span class=nx>_idx_start</span><span class=p>,</span> <span class=nx>_idx_end</span>] <span class=p>=</span> <span class=nx>matchstrpos</span><span class=p>(</span><span class=nx>line_text</span><span class=p>,</span> <span class=nx>url_pattern</span><span class=p>,</span> <span class=nx>_idx_end</span><span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=nx>endwhile</span><span class=err>
</span><span class=err></span><span class=c>
</span><span class=c>  &#34; echo url_infos</span><span class=err>
</span><span class=err></span><span class=c>  &#34; If no URL is found, do nothing.</span><span class=err>
</span><span class=err></span>  <span class=k>if</span> <span class=nx>len</span><span class=p>(</span><span class=nx>url_infos</span><span class=p>)</span> <span class=p>==</span> <span class=m>0</span><span class=err>
</span><span class=err></span>    <span class=nx>return</span><span class=err>
</span><span class=err></span>  <span class=k>endif</span><span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> [<span class=nx>start_col</span><span class=p>,</span> <span class=nx>end_col</span>] <span class=p>=</span> [<span class=m>-1</span><span class=p>,</span> <span class=m>-1</span>]<span class=err>
</span><span class=err></span><span class=c>  &#34; If URL is found, find if cursor is on it.</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> [<span class=nx>buf_num</span><span class=p>,</span> <span class=nx>cur_row</span><span class=p>,</span> <span class=nx>cur_col</span>] <span class=p>=</span> <span class=nx>getcurpos</span><span class=p>()</span>[<span class=m>0</span>:<span class=m>2</span>]<span class=err>
</span><span class=err></span>  <span class=nx>for</span> <span class=nx>url_info</span> <span class=nx>in</span> <span class=nx>url_infos</span><span class=err>
</span><span class=err></span><span class=c>    &#34; echo url_info</span><span class=err>
</span><span class=err></span>    <span class=k>let</span> [<span class=nx>_url</span><span class=p>,</span> <span class=nx>_idx_start</span><span class=p>,</span> <span class=nx>_idx_end</span>] <span class=p>=</span> <span class=nx>url_info</span><span class=err>
</span><span class=err></span>    <span class=k>if</span> <span class=nx>cur_col</span> <span class=p>&gt;=</span> <span class=nx>_idx_start</span> &amp;&amp; <span class=nx>cur_col</span> <span class=p>&lt;=</span> <span class=nx>_idx_end</span><span class=err>
</span><span class=err></span>      <span class=k>let</span> <span class=nx>start_col</span> <span class=p>=</span> <span class=nx>_idx_start</span><span class=err>
</span><span class=err></span>      <span class=k>let</span> <span class=nx>end_col</span> <span class=p>=</span> <span class=nx>_idx_end</span><span class=err>
</span><span class=err></span>      <span class=nx>break</span><span class=err>
</span><span class=err></span>    <span class=k>endif</span><span class=err>
</span><span class=err></span>  <span class=nx>endfor</span><span class=err>
</span><span class=err></span><span class=c>
</span><span class=c>  &#34; Cursor is not on a URL, do nothing.</span><span class=err>
</span><span class=err></span>  <span class=k>if</span> <span class=nx>start_col</span> <span class=p>==</span> <span class=m>-1</span><span class=err>
</span><span class=err></span>    <span class=nx>return</span><span class=err>
</span><span class=err></span>  <span class=k>endif</span><span class=err>
</span><span class=err></span><span class=c>
</span><span class=c>  &#34; &#34; now set the &#39;&lt; and &#39;&gt; mark</span><span class=err>
</span><span class=err></span>  <span class=nx>call</span> <span class=nx>setpos</span><span class=p>(</span><span class=s2>&#34;&#39;&lt;&#34;</span><span class=p>,</span> [<span class=nx>buf_num</span><span class=p>,</span> <span class=nx>cur_row</span><span class=p>,</span> <span class=nx>start_col</span><span class=p>,</span> <span class=m>0</span>]<span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=nx>call</span> <span class=nx>setpos</span><span class=p>(</span><span class=s2>&#34;&#39;&gt;&#34;</span><span class=p>,</span> [<span class=nx>buf_num</span><span class=p>,</span> <span class=nx>cur_row</span><span class=p>,</span> <span class=nx>end_col</span><span class=p>,</span> <span class=m>0</span>]<span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=nx>normal</span><span class=p>!</span> <span class=nx>gv</span><span class=err>
</span><span class=err></span><span class=k>endfunction</span><span class=err>
</span></code></pre></div><p>In the above code, we first find the end and start index of all URLs in current
line. We then check if current cursor position is on one of those URLs. If that
is true, we then set the <code>'&lt;</code> and <code>'></code> mark to the start and end index of this
URL. Finally, we use <code>gv</code> to select this URL (see <code>:h gv</code>) .</p>
<p>In the above code, we use the URL pattern from a plugin called
<a href=https://github.com/itchyny/vim-highlighturl>vim-highlighturl</a> if it is
installed or use <a href=https://jdhao.github.io/2020/11/11/nifty_nvim_techniques_s8/#copy-url-under-cursor-into-a-register><code>expand("&lt;cfile>")</code></a>
to get the URL under cursor. Note that <code>expand("&lt;cfile>")</code> also works for
non-URL text, the text object <code>iu</code> will also work for non-URL text. It is
better to use the URL pattern provided by vim-highlighturl.</p>
<p>There is another shorter, but probably <em>hacky</em> way to define the URL text
object:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>URLTextObj</span><span class=p>()</span> <span class=nx>abort</span><span class=err>
</span><span class=err></span><span class=c>  &#34; We need to find the start and end of URL, and select the entire URL string.</span><span class=err>
</span><span class=err></span><span class=c>  &#34; the following does not work well, since it also shows results even when</span><span class=err>
</span><span class=err></span><span class=c>  &#34; cursor is not on a valid URL.</span><span class=err>
</span><span class=err></span><span class=c>  &#34; let url = expand(&#39;&lt;cfile&gt;&#39;)</span><span class=err>
</span><span class=err></span><span class=c>  &#34; a better way to get url.</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>url</span> <span class=p>=</span> <span class=nx>matchstr</span><span class=p>(</span><span class=nx>getline</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>),</span> <span class=nx>highlighturl</span>#<span class=nx>default_pattern</span><span class=p>())</span><span class=err>
</span><span class=err></span>  <span class=nx>normal</span><span class=p>!</span> ^<span class=err>
</span><span class=err></span><span class=c>  &#34; We should escape special patterns in url, see https://superuser.com/q/320398/736190,</span><span class=err>
</span><span class=err></span><span class=c>  &#34; see also https://stackoverflow.com/a/46235399/6064933</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>url</span> <span class=p>=</span> <span class=nx>escape</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=s1>&#39;/&#39;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=c>  &#34; I got the inspiration here: https://vi.stackexchange.com/a/2925/15292</span><span class=err>
</span><span class=err></span>  <span class=nx>silent</span><span class=p>!</span> <span class=nx>execute</span> <span class=s2>&#34;normal! /\\V&#34;</span> . <span class=nx>url</span> . <span class=s2>&#34;/s\&lt;CR&gt;v//e\&lt;CR&gt;&#34;</span><span class=err>
</span><span class=err></span><span class=k>endfunction</span><span class=err>
</span></code></pre></div><p>Note that you are <strong>not</strong> required to define URL text object as <code>iu</code>, any valid
LHS for mappings is acceptable. We use <code>iu</code> because it conforms to the naming
style of native text objects.</p>
<h1 id=a-text-object-for-markdown-code-blocks>A text object for Markdown code blocks</h1>
<p>For Markdown code blocks, it is necessary to define both inner and around text
objects. We will use <code>ic</code> and <code>ac</code> to denote <strong>inner</strong> code block and
<strong>around</strong> code block, respectively.</p>
<p>Here is a sample implementation<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>vnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>ic</span> :<span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>U</span><span class=p>&gt;</span><span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>MdCodeBlockTextObj</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>)&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err></span><span class=nx>onoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>ic</span> :<span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>U</span><span class=p>&gt;</span><span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>MdCodeBlockTextObj</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>)&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nx>vnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>ac</span> :<span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>U</span><span class=p>&gt;</span><span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>MdCodeBlockTextObj</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>)&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err></span><span class=nx>onoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>ac</span> :<span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>U</span><span class=p>&gt;</span><span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>MdCodeBlockTextObj</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>)&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>MdCodeBlockTextObj</span><span class=p>(</span><span class=nx>type</span><span class=p>)</span> <span class=nx>abort</span><span class=err>
</span><span class=err></span><span class=c>  &#34; the parameter type specify whether it is inner text objects or around</span><span class=err>
</span><span class=err></span><span class=c>  &#34; text objects.</span><span class=err>
</span><span class=err></span><span class=c>
</span><span class=c>  &#34; Move the cursor to the end of line in case that cursor is on the opening</span><span class=err>
</span><span class=err></span><span class=c>  &#34; of a code block. Actually, there are still issues if the cursor is on the</span><span class=err>
</span><span class=err></span><span class=c>  &#34; closing of a code block. In this case, the start row of code blocks would</span><span class=err>
</span><span class=err></span><span class=c>  &#34; be wrong. Unless we can match code blocks, it is not easy to fix this.</span><span class=err>
</span><span class=err></span>  <span class=nx>normal</span><span class=p>!</span> $<span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>start_row</span> <span class=p>=</span> <span class=nx>searchpos</span><span class=p>(</span><span class=s1>&#39;\s*```&#39;</span><span class=p>,</span> <span class=s1>&#39;bnW&#39;</span><span class=p>)</span>[<span class=m>0</span>]<span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>end_row</span> <span class=p>=</span> <span class=nx>searchpos</span><span class=p>(</span><span class=s1>&#39;\s*```&#39;</span><span class=p>,</span> <span class=s1>&#39;nW&#39;</span><span class=p>)</span>[<span class=m>0</span>]<span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>buf_num</span> <span class=p>=</span> <span class=nx>bufnr</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=c>  &#34; For inner code blocks, remove the start and end line containing backticks.</span><span class=err>
</span><span class=err></span>  <span class=k>if</span> <span class=nx>a</span>:<span class=nx>type</span> <span class=p>==</span># <span class=s1>&#39;i&#39;</span><span class=err>
</span><span class=err></span>    <span class=k>let</span> <span class=nx>start_row</span> <span class=p>+=</span> <span class=m>1</span><span class=err>
</span><span class=err></span>    <span class=k>let</span> <span class=nx>end_row</span> <span class=p>-=</span> <span class=m>1</span><span class=err>
</span><span class=err></span>  <span class=k>endif</span><span class=err>
</span><span class=err></span><span class=c>  &#34; echo a:type start_row end_row</span><span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=nx>call</span> <span class=nx>setpos</span><span class=p>(</span><span class=s2>&#34;&#39;&lt;&#34;</span><span class=p>,</span> [<span class=nx>buf_num</span><span class=p>,</span> <span class=nx>start_row</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>0</span>]<span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=nx>call</span> <span class=nx>setpos</span><span class=p>(</span><span class=s2>&#34;&#39;&gt;&#34;</span><span class=p>,</span> [<span class=nx>buf_num</span><span class=p>,</span> <span class=nx>end_row</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>0</span>]<span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=nx>execute</span> <span class=s1>&#39;normal! `&lt;V`&gt;&#39;</span><span class=err>
</span><span class=err></span><span class=k>endfunction</span><span class=err>
</span></code></pre></div><p>Since code blocks are line-wise inherently, we only need to decide its start
and end row. With this info, we can set the <code>'&lt;</code> and <code>'></code> mark. Then we can
easily select the desire text. This time, we use visual-line mode, since it
makes more sense to select code blocks in visual-line mode.</p>
<h1 id=conclusion>Conclusion</h1>
<p>In this post, I have introduced how does text object work and how to define
your own text objects. The most important part is to know your text object well
and find ways to visually select it when the corresponding shortcut is pressed.</p>
<h1 id=references>References</h1>
<ul>
<li><a href=https://vim.fandom.com/wiki/Creating_new_text_objects>vim wiki: create new text objects</a></li>
<li><a href=https://vi.stackexchange.com/q/6101/15292>Is there a text object for current line?</a></li>
<li><a href=https://vi.stackexchange.com/q/2319/15292>Is there a text object for the entire buffer?</a></li>
<li>A plugin to create user text objects easily: <a href=https://github.com/kana/vim-textobj-user>https://github.com/kana/vim-textobj-user</a></li>
<li><a href=https://25.wf/posts/2020-09-04-vim-markdown-text-object.html>https://25.wf/posts/2020-09-04-vim-markdown-text-object.html</a></li>
<li><a href=https://vimways.org/2018/transactions-pending/>https://vimways.org/2018/transactions-pending/</a></li>
</ul>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>Other implementations can be found in <a href=https://github.com/plasticboy/vim-markdown/issues/282>this issue</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>Author</span>
<span class=item-content>jdhao</span>
</p>
<p class=copyright-item>
<span class=item-title>LastMod</span>
<span class=item-content>
2022-02-02
</span>
</p>
<p class=copyright-item>
<span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<div class=post-reward>
<input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>Reward</label>
<div class=qr-code>
<label class=qr-code-image for=reward>
<img class=image src=https://blog-resource-1257868508.file.myqcloud.com/wechat.png>
<span>wechat</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=https://blog-resource-1257868508.file.myqcloud.com/zhifubao.jpg>
<span>alipay</span>
</label>
</div>
</div><footer class=post-footer>
<div class=post-tags>
<a href=/tags/text-object/>text-object</a>
<a href=/tags/Vim/>Vim</a>
</div>
<nav class=post-nav>
<a class=prev href=/2020/11/16/vim_lsp_fuzzy_completion/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Set up Fuzzy Completion for Vim-lsp</span>
<span class="prev-text nav-mobile">Prev</span>
</a>
<a class=next href=/2020/11/11/nifty_nvim_techniques_s8/>
<span class="next-text nav-default">Nifty Nvim/Vim Techniques That Make My Life Easier -- Series 8</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a>
<a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://www.linkedin.com/in/jiedong-hao-740163227/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/jdhao class="iconfont icon-github" title=github></a>
<a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<div class=busuanzi-footer>
<span id=busuanzi_container_site_pv> site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> </span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv> site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> </span>
</div>
<span class=copyright-year>
&copy;
2017 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],tags:'ams'}}</script>
<script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-113395108-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_push>(function(){var a,c,b;if(window.location.hostname==='localhost')return;a=document.createElement('script'),a.async=!0,c=window.location.protocol.split(':')[0],c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>